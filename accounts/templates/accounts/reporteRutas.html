{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <meta charset="UTF-8">
    <title>Administración | Gou II</title>
    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
    <!-- Bootstrap 3.3.2 -->
    <link href="static/accounts/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- Font Awesome Icons -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <!-- Ionicons -->
    <link href="http://code.ionicframework.com/ionicons/2.0.0/css/ionicons.min.css" rel="stylesheet" type="text/css" />
    <!-- Theme style -->
    <link href="static/accounts/AdminLTE.min.css" rel="stylesheet" type="text/css" />
    <link href="static/accounts/skins/_all-skins.min.css" rel="stylesheet" type="text/css" />


    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Rutas</title>
    <style>
        .logo {
              color: #FFFFFF; 
              text-decoration: none; 
              font-family: 'Arial', sans-serif;
              font-size: 24px; 
              text-shadow: 2px 2px 4px #000000; 
            }
            .logo .admin {
              font-weight: normal;
              color: #FFFFFF; 
            }
      
        
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        
        .search-container {
            text-align: center;
            font-size: 30px;
            margin: 40px;
        }
        .search-container input {
            padding: 10px;
            width: 300px;
            font-size: 16px;
        }
        .search-container button {
            padding: 10px 15px;
            font-size: 16px;
            background-color: #27ae60;
            color: white;
            border: none;
            cursor: pointer;
        }
        .search-container button:hover {
            background-color: #219150;
        }
        .table-container {
            margin: 20px auto;
            width: 80%;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #27ae60;
            color: white;
        }
      
    </style>
    
</head>
<body class="skin-green">
    <div class="wrapper">
        <header class="main-header">    
            <a href="{% url 'principal' %}" class="logo">
              <span class="admin">{{ usuario.rol }}</span>
            </a>
          <nav class="navbar navbar-static-top" role="navigation">
            <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
              <span class="sr-only"></span>
            </a>
            <!-- Menu -->
            <div class="navbar-custom-menu">
              <ul class="nav navbar-nav">
                <li class="dropdown user user-menu">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                    <img src="data:image/png;base64,{{ image_data }}" class="user-image" alt="User Image">
                    <span class="hidden-xs">{{ usuario.nombre }} {{ usuario.apellido }}</span>
                  </a>
                  <ul class="dropdown-menu">
                    <!-- User image -->
                    <li class="user-header">
                      <img src="data:image/png;base64,{{ image_data }}" class="user-image" alt="User Image">
                      <div style="text-align: center; padding: 20px;">
                        <h2 style="margin: 0; font-size: 24px; color: #f1e9e9; font-weight: 600;">{{ usuario.nombre }} {{ usuario.apellido }}</h2>
                        <p style="margin: 5px 0; font-size: 18px; color: #eaeef3; font-weight: 500;">{{ usuario.rol }}</p>
                          <small>Universidad de Cundinamarca</small>
                        </p>
                      </div>
                    </li>
                    <!-- Botones -->
                    <li class="user-footer">
                      <div class="pull-left">
                        <a href="{% url 'config' %}" class="btn btn-default btn-flat">Configuración</a>
                      </div>
                      <div class="pull-right">
                        <a href="{% url 'login' %}" class="btn btn-default btn-flat">Cerrar sesión</a>
                      </div>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </nav>
        </header>
        <!-- Left side column. contains the logo and sidebar -->
        <aside class="main-sidebar">
          <!-- sidebar: style can be found in sidebar.less -->
          <section class="sidebar">
            <!-- Sidebar user panel -->
            <div class="user-panel">
              <div class="pull-left image">
                <img src="data:image/jpg;base64,{{ image_data }}" class="img-circle" alt="User Image" />
              </div>
              <div class="pull-left info">
                <p>{{ usuario.nombre }} {{ usuario.apellido }}</p>
                <a href="#"><i class="fa fa-circle text-success"></i> Online</a>
            </div>          
            </div>
  
         
            <!-- MENÚ PRINCIPAL-->
            <ul class="sidebar-menu">
              <li class="header">MENÚ PRINCIPAL</li>
  
              <!-- USUARIOS-->
              <li class="active treeview">
                <a href="{% url 'usuario' %}">
                  <i class="fa fa-users"></i>
                  <span>Usuarios</span>
                  <span class="label label-primary pull-right"></span>
                </a>
              </li>
  
              <!-- REPORTES-->
              <li class="active treeview">
                <a href="#">
                  <i class="fa fa-dashboard"></i> 
                  <span>Reportes</span> 
                  <i class="fa fa-angle-left pull-right"></i>
                </a>
                <ul class="treeview-menu">
                  <li><a href="{% url 'reporteRutas' %}"><i class="fa fa-circle-o"></i> Reporte Rutas</a></li>
                <li><a href="{% url 'reporte_municipio' %}"><i class="fa fa-circle-o"></i> Reporte Municipios</a></li>
                <li><a href="{% url 'reporteUsuariosDestacados' %}"><i class="fa fa-circle-o"></i> Reporte Usuarios Destacados</a></li>
                </ul>
              </li>
  
              <!-- DOCUMENTACIÓN-->
              <li>
                <a href="{% url 'documento' %}">
                  <i class="fa fa-envelope"></i> <span>Documentación</span>
                </a>
              </li>
  
              <!-- RESEÑAS-->
              <li>
                <a href="{% url 'resena' %}">
                  <i class="fa fa-th"></i> <span>Reseñas</span>
                </a>
              </li>
  
              <!-- ADMINISTRADORES-->
              <li class="active treeview">
                <a href="{% url 'cuentas' %}">
                  <i class="fa fa-user"></i>
                  <span>Administrador</span>
                  <span class="label label-primary pull-right"></span>
                </a>
              </li>
            </ul>
          </section>
        </aside>

        <div class="content-wrapper">
          <section class="content">

        <div class="search-container">
          <label for="email">Consulta de información relacionada con los conductores</label><br><br>
          <label for="email" style="font-size: 20px; margin-right: 10px;">Ingrese email:</label>
          <input type="text" id="email" name="email" placeholder="@ucundinamarca.edu.co">
          <button onclick="buscarEmail()">Buscar</button>
      </div>
       <!-- Botones para descargar los reportes -->
  
      
    <div id="reporte-rutas">
            <!-- Aquí va el código de la tabla -->
      <!-- Después de la tabla de Reporte de Rutas -->
      <div class="table-container" id="tabla-resultados" style="display:none;">
        <h2>Reporte de Ruta</h2>
        <table>
            <thead>
                <tr>
                    <th>Nombres</th>
                    <th>Apellidos</th>
                    <th>Email</th>
                    <th>Origen</th>
                    <th>Destino</th>
                </tr>
            </thead>
            <tbody id="datos-tabla"></tbody>
        </table>
        
      </div>
</div>

<div id="historial-rutas">
  <!-- Después de la tabla de Historial de Rutas -->
<div class="table-container" id="tabla-historial" style="display:none;">
  <h2>Historial de Rutas</h2>
  <table>
      <thead>
          <tr>
              <th>Origen</th>
              <th>Destino</th>
              <th>Fecha de Salida</th>
              <th>Hora de Salida</th>
          </tr>
      </thead>
      <tbody id="datos-historial"></tbody>
  </table>
  <!-- Botón de descarga PDF -->
  <div style="text-align: right; margin-top: 10px;">
    <a href="#" id="pdf-button" class="btn btn-danger" style="background-color: #ff0000; color: white;" onclick="descargarPDF()">
        Descargar rutas PDF
    </a>
</div>

</div>

</div>
      
      <script>
      function buscarEmail() {
    const email = document.getElementById('email').value;

    // Limpiar las tablas de resultados
    const tabla = document.getElementById('tabla-resultados');
    const tbody = document.getElementById('datos-tabla');
    const tablaHistorial = document.getElementById('tabla-historial');
    const tbodyHistorial = document.getElementById('datos-historial');
   
    // Limpiar el contenido previo de las tablas
    tbody.innerHTML = '';
    tbodyHistorial.innerHTML = '';
   
    fetch(`/buscar_ruta/?email=${email}`)
  
    
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Mostrar resultados de "Reporte de Rutas"
                data.rutas.forEach(ruta => {
                    const row = `<tr>
                        <td style="text-transform: capitalize;">${ruta.nombre}</td>
                        <td style="text-transform: capitalize;">${ruta.apellidos}</td>
                        <td>${ruta.email}</td>
                        <td>${ruta.origin}</td>
                        <td>${ruta.destination}</td>
                    </tr>`;
                    tbody.innerHTML += row;
                });
                tabla.style.display = 'block';

                // Mostrar resultados de "Historial de Rutas"
                data.historial.forEach(historial => {
                    const row = `<tr>
                        <td>${historial.origin}</td>
                        <td>${historial.destination}</td>
                        <td>${historial.fechaSalida}</td>
                        <td>${historial.horaSalida}</td>
                    </tr>`;
                    tbodyHistorial.innerHTML += row;
                });
                tablaHistorial.style.display = 'block';

      
            } 
            
            

            // Limpiar el campo de email después de la búsqueda
            document.getElementById('email').value = '';
        });
        // Actualiza el href del botón dinámicamente
    const pdfButton = document.getElementById('pdf-button');
    pdfButton.href = `/generar_pdf_ruta?email=${email}`; // Construir la URL con el email

        
}
        </script>
        <div>

        </section>
       
        
      </div>
        
  

    
     <!-- jQuery 2.1.3 -->
     <script src="{% static 'accounts/js/plugins/jQuery/jQuery-2.1.3.min.js'%}"></script>
     <!-- Bootstrap 3.3.2 JS -->
     <script src="{% static 'accounts/js/bootstrap.min.js'%}" ></script>
     <!-- FastClick -->
     <script src="{% static 'accounts/js/plugins/fastclick/fastclick.min.js'%}"></script>
     <!-- AdminLTE App -->
     <script src="{% static 'accounts/js/app.min.js'%}"></script>
     <!-- Sparkline -->
     <script src="{% static 'accounts/js/plugins/sparkline/jquery.sparkline.min.js'%}" ></script>
     <!-- jvectormap -->
     <script src="{% static 'accounts/js/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js'%}"></script>
     <script src="{% static 'accounts/js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js'%}" ></script>
     <!-- daterangepicker -->
     <script src="{% static 'accounts/js/plugins/daterangepicker/daterangepicker.js'%}" ></script>
     <!-- datepicker -->
     <script src="{% static 'accounts/js/plugins/datepicker/bootstrap-datepicker.js'%}" ></script>
     <!-- iCheck -->
     <script src="{% static 'accounts/js/plugins/iCheck/icheck.min.js'%}"></script>
     <!-- SlimScroll 1.3.0 -->
     <script src="{% static 'accounts/js/plugins/slimScroll/jquery.slimscroll.min.js'%}" ></script>
     <!-- ChartJS 1.0.1 -->
     <script src="{% static 'accounts/js/plugins/chartjs/Chart.min.js'%}" ></script>
 
     
 
     <!-- AdminLTE for demo purposes -->
     <script src="{% static 'accounts/js/demo.js'%}" ></script> 
</body>
</html>
